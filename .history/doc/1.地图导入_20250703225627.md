# 地图导入

**包名**：`map_loader`

**节点名**：`map_loader`

**输入**：

| 数据名 |               数据描述                |            数据类型            |  订阅  |
| :----: | :-----------------------------------: | :----------------------------: | :----: |
| `msg`  | 静态地图文件，由`nav2_map_server`提供 | `nav_msgs::msg::OccupancyGrid` | `/map` |

**输出**：	

|     数据名      | 数据描述 |            数据类型            |       发布       |
| :-------------: | :------: | :----------------------------: | :--------------: |
| `processed_map` | 地图文件 | `nav_msgs::msg::OccupancyGrid` | `/processed_map` |

**`launch`文件**

`map_loader.launch.py`

* 地图源文件路径：`map_loader/maps/map.yaml`
* `map_server`节点：ROS自带的读取地图文件文件的节点
* `lifecycle_manager_map`节点：`map_server`的生命周期管理节点，需要该节点才能激活`map_server`
* `map_loader`节点：地图导如节点
  1. 从`map_server`订阅地图数据
  2. 处理数据
  3. 将处理好的地图数据发布

**参考**：

1. **关于`map_server`启动默认不激活，激活后Rviz和`ros2 topic echo`不显示话题内容的问题**

   [【ROS2 核心知识】关于lifecycle_node和话题QoS profile的扩展和杂谈-- nav2_map_server的配置](https://blog.csdn.net/m0_73800387/article/details/143452281)



**问题**：

1. 在参考项目中，地图数据会用一个双端对列保存，查看后续的处理代码，也只会拿出一次的地图来处理，这个地方不知道为什么？

2. 关于话题发布的QoS策略

   | 特性               | `volatile` | `transient_local`   |
   | :----------------- | :--------- | :------------------ |
   | 历史消息保留       | ❌ 不保留   | ✅ 保留（根据depth） |
   | 新订阅者获取旧消息 | ❌ 不可能   | ✅ 自动获取          |
   | 内存占用           | 最低       | 较高（需缓存消息）  |
   | 适用场景           | 实时数据流 | 配置/状态/地图数据  |
   | 发布者退出影响     | 无遗留数据 | 缓存消息丢失        |

